<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Totem pubblicitario</title>

    <script>
        "use strict"
        let httpRequest;
        let httpRequest2;

        function paginaCaricata() {
            httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = cerca;
            httpRequest.open('GET', 'http://10.1.0.174:8080/prodotto/elenco');
            httpRequest.send();
            httpRequest2 = new XMLHttpRequest();
            httpRequest2.onreadystatechange = cerca2;
            httpRequest2.open('GET', 'http://10.1.0.174:8080/promozione/elenco');
            httpRequest2.send();
        }

        function cerca() {
            if (httpRequest.readyState == XMLHttpRequest.DONE) {
                if (httpRequest.status == 200) {
                    let oggetto = JSON.parse(httpRequest.responseText);
                    for(let i=0; i<oggetto.length; i++){
                        let nom = oggetto[i].nome;
                        let pre = oggetto[i].prezzo;
                        let cal = oggetto[i].calorie;
                        let gra = oggetto[i].grassi;
                        let zuc = oggetto[i].zuccheri;
                        let pro = oggetto[i].proteine;
                        let lDiv = document.createElement("div");  
                        let lCont = document.getElementById("cont");  
                        let lNome = document.createElement("label");
                        let lCalo = document.createElement("label"); 
                        let lGrassi = document.createElement("label"); 
                        let lZuccheri = document.createElement("label"); 
                        let lProteine = document.createElement("label");                                                      
                        let lPrezzo = document.createElement("label");
                        lNome.innerText = nom + " = ";
                        lPrezzo.innerText = pre + "â‚¬ ";
                        lCalo.innerText = "Calorie: " + cal + ", ";
                        lGrassi.innerText = "Grassi: " + gra + ", ";
                        lZuccheri.innerText = "Zuccheri: " + zuc + ", ";
                        lProteine.innerText = "Proteine : " + pro + ", ";
                        lCont.appendChild(lDiv);
                        lDiv.appendChild(lNome);
                        lDiv.appendChild(lPrezzo);
                        lDiv.appendChild(lCalo);
                        lDiv.appendChild(lGrassi);
                        lDiv.appendChild(lZuccheri);
                        lDiv.appendChild(lProteine);
                        
                    }
                } else {
                    let lErrore = document.getElementById("pErrore")
                    lErrore.innerText = "ERRORE";
                }
            }
        }
        function cerca2() {
            if (httpRequest2.readyState == XMLHttpRequest.DONE) {
                if (httpRequest2.status == 200) {
                    let oggetto2 = JSON.parse(httpRequest2.responseText);
                    for(let i=0; i<oggetto2.length; i++){
                        let desc = oggetto2[i].descrizione;
                        let iP = oggetto2[i].inizio;
                        let fP = oggetto2[i].fine;
                        let pAtt = false;
                        let today = new Date();
                        const compareDates = (d1, d2, d3) => {
                            let date1 = new Date(d1).getTime();
                            let date2 = new Date(d2).getTime();
                            let date3 = new Date(d3).getTime();

                            if (date1 <= date2 & date2 <= date3) {
                                pAtt = true;
                                } else {
                                pAtt = false
                            };
                        }
                        compareDates(iP, today, fP);
                        let lDiv = document.createElement("div");  
                        let lCont = document.getElementById("contprom");  
                        let lDesc = document.createElement("label");
                        let lIP = document.createElement("label");
                        let lFP = document.createElement("label");
                        let lT = document.createElement("label");
                        lDesc.innerText = desc + ": ";
                        lIP.innerText = "Dal " + iP + " al ";
                        lFP.innerText = fP + " ";
                        if (pAtt == true) {
                            lT.innerText = "attiva";
                        } else {
                            lT.innerText = "non attiva";
                        }
                        lCont.appendChild(lDiv);
                        lDiv.appendChild(lDesc);
                        lDiv.appendChild(lIP);
                        lDiv.appendChild(lFP);
                        lDiv.appendChild(lT);
                
                    }
                } else {
                    let lErrore = document.getElementById("pErrore")
                    lErrore.innerText = "ERRORE";
                }
            }
        }


    </script>

</head>
<style>
    h1 {
        text-align: center;
        font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
        background-color: aliceblue;
        color: orangered;
    }
    body {
        background-image: url("sfondomenu.jpg");
    }
    #cont{
        background-color: white;
    }
    #contprom {
        background-color: orangered;
    }
</style>
<body onload="paginaCaricata()">
    <h1 id="pErrore">Menu merende</h1>
    <div id="contprom"></div>
    <div id="cont"></div>
</body>

</html>